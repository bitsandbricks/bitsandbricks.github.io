<!DOCTYPE html>
<html lang="es" xml:lang="es">
<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta property="og:title" content="3.3 Transformando los datos | Ciencia de Datos para Gente Sociable" />
<meta property="og:type" content="book" />



<meta name="github-repo" content="bitsandbricks/datos_sociables" />

<meta name="author" content="Antonio Vazquez Brust" />

<meta name="date" content="2021-08-05" />

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  TeX: { equationNumbers: { autoNumber: "AMS" } }
});
</script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js" type="text/javascript"></script>

<meta name="description" content="3.3 Transformando los datos | Ciencia de Datos para Gente Sociable">

<title>3.3 Transformando los datos | Ciencia de Datos para Gente Sociable</title>

<script src="libs/header-attrs-2.9/header-attrs.js"></script>
<script src="libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="libs/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="libs/navigation-1.1/tabsets.js"></script>
<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>




<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
/* show arrow before summary tag as in bootstrap
TODO: remove if boostrap in updated in html_document (rmarkdown#1485) */
details > summary {
  display: list-item;
  cursor: pointer;
}
</style>
</head>

<body>

<div class="container-fluid main-container">


<div class="row">
<div class="col-sm-12">
<div id="TOC">
<ul>
<li><a href="index.html#section"></a>
<ul>
<li><a href="para-quién-es-esto.html#para-quién-es-esto">¿Para quién es esto?</a></li>
<li><a href="antes-de-empezar.html#antes-de-empezar">Antes de empezar</a></li>
</ul></li>
<li><a href="1-qué-es-la-ciencia-de-datos.html#qué-es-la-ciencia-de-datos"><span class="toc-section-number">1</span> ¿Qué es la ciencia de datos?</a>
<ul>
<li><a href="1-1-qué-significa-hacer-ciencia-de-datos.html#qué-significa-hacer-ciencia-de-datos"><span class="toc-section-number">1.1</span> ¿Qué significa hacer ciencia de datos?</a></li>
</ul></li>
<li><a href="2-una-presentación-a-toda-marcha-de-r.html#una-presentación-a-toda-marcha-de-r"><span class="toc-section-number">2</span> Una presentación a toda marcha de R</a>
<ul>
<li><a href="2-1-nuestro-primer-proyecto-en-r.html#nuestro-primer-proyecto-en-r"><span class="toc-section-number">2.1</span> Nuestro primer proyecto en R</a>
<ul>
<li><a href="2-1-nuestro-primer-proyecto-en-r.html#a-investigar-cual-es-la-diferencia-en-mortalidad-infantil-entre-el-sur-y-el-norte-de-la-ciudad-autónoma-de-buenos-aires"><span class="toc-section-number">2.1.1</span> A investigar: ¿Cual es la diferencia en mortalidad infantil entre el sur y el norte de la Ciudad Autónoma de Buenos Aires?</a></li>
<li><a href="2-1-nuestro-primer-proyecto-en-r.html#crear-un-proyecto-en-rstudio"><span class="toc-section-number">2.1.2</span> Crear un proyecto en RStudio</a></li>
<li><a href="2-1-nuestro-primer-proyecto-en-r.html#escribiendo-un-script"><span class="toc-section-number">2.1.3</span> Escribiendo un script</a></li>
<li><a href="2-1-nuestro-primer-proyecto-en-r.html#cargar-los-datos"><span class="toc-section-number">2.1.4</span> Cargar los datos</a></li>
</ul></li>
<li><a href="2-2-visualización-la-exploración-gráfica-de-la-información.html#visualización-la-exploración-gráfica-de-la-información"><span class="toc-section-number">2.2</span> Visualización: la exploración gráfica de la información</a>
<ul>
<li><a href="2-2-visualización-la-exploración-gráfica-de-la-información.html#haciendo-mapas"><span class="toc-section-number">2.2.1</span> Haciendo mapas</a></li>
<li><a href="2-2-visualización-la-exploración-gráfica-de-la-información.html#agregando-datos"><span class="toc-section-number">2.2.2</span> Agregando datos</a></li>
</ul></li>
<li><a href="2-3-el-veredicto-final.html#el-veredicto-final"><span class="toc-section-number">2.3</span> El veredicto final</a>
<ul>
<li><a href="2-3-el-veredicto-final.html#cuál-es-la-diferencia-en-mortalidad-infantil-entre-el-sur-y-el-norte-de-la-ciudad-autónoma-de-buenos-aires"><span class="toc-section-number">2.3.1</span> ¿Cuál es la diferencia en mortalidad infantil entre el sur y el norte de la Ciudad Autónoma de Buenos Aires?</a></li>
</ul></li>
<li><a href="2-4-ejercicios.html#ejercicios"><span class="toc-section-number">2.4</span> Ejercicios</a></li>
</ul></li>
<li><a href="3-poniendo-los-datos-en-forma.html#poniendo-los-datos-en-forma"><span class="toc-section-number">3</span> Poniendo los datos en forma</a>
<ul>
<li><a href="3-1-primeros-pasos-al-examinar-un-conjunto-de-datos-nuevo.html#primeros-pasos-al-examinar-un-conjunto-de-datos-nuevo"><span class="toc-section-number">3.1</span> Primeros pasos al examinar un conjunto de datos nuevo</a></li>
<li><a href="3-2-cruzando-variables-la-operación-join.html#cruzando-variables-la-operación-join"><span class="toc-section-number">3.2</span> Cruzando variables: la operación <code>join</code></a></li>
<li><a href="3-3-transformando-los-datos.html#transformando-los-datos"><span class="toc-section-number">3.3</span> Transformando los datos</a>
<ul>
<li><a href="3-3-transformando-los-datos.html#seleccionar-columnas-con-select"><span class="toc-section-number">3.3.1</span> Seleccionar columnas con <code>select()</code></a></li>
<li><a href="3-3-transformando-los-datos.html#filtrar-filas-con-filter"><span class="toc-section-number">3.3.2</span> Filtrar filas con <code>filter()</code></a></li>
<li><a href="3-3-transformando-los-datos.html#ordenar-filas-con-arrange"><span class="toc-section-number">3.3.3</span> Ordenar filas con <code>arrange()</code></a></li>
<li><a href="3-3-transformando-los-datos.html#agregar-nuevas-variables-con-mutate"><span class="toc-section-number">3.3.4</span> Agregar nuevas variables con <code>mutate()</code></a></li>
<li><a href="3-3-transformando-los-datos.html#extraer-sumarios-con-summarise"><span class="toc-section-number">3.3.5</span> Extraer sumarios con <code>summarise()</code></a></li>
<li><a href="3-3-transformando-los-datos.html#bonus-el-operador-pipe"><span class="toc-section-number">3.3.6</span> ¡BONUS! El operador “pipe”: <code>%&gt;%</code></a></li>
</ul></li>
<li><a href="3-4-ejercicios-1.html#ejercicios-1"><span class="toc-section-number">3.4</span> Ejercicios</a></li>
</ul></li>
<li><a href="4-visualización.html#visualización"><span class="toc-section-number">4</span> Visualización</a>
<ul>
<li><a href="4-1-una-buena-visualización-para-empezar-el-scatterplot.html#una-buena-visualización-para-empezar-el-scatterplot"><span class="toc-section-number">4.1</span> Una buena visualización para empezar: el <em>scatterplot</em></a></li>
<li><a href="4-2-ajustando-color-y-tamaño.html#ajustando-color-y-tamaño"><span class="toc-section-number">4.2</span> Ajustando color y tamaño</a></li>
<li><a href="4-3-facetado.html#facetado"><span class="toc-section-number">4.3</span> Facetado</a></li>
<li><a href="4-4-gráficos-de-barras.html#gráficos-de-barras"><span class="toc-section-number">4.4</span> Gráficos de barras</a></li>
<li><a href="4-5-histogramas.html#histogramas"><span class="toc-section-number">4.5</span> Histogramas</a></li>
<li><a href="4-6-preparando-una-visualización-para-compartir.html#preparando-una-visualización-para-compartir"><span class="toc-section-number">4.6</span> Preparando una visualización para compartir</a></li>
<li><a href="4-7-otras-visualizaciones.html#otras-visualizaciones"><span class="toc-section-number">4.7</span> Otras visualizaciones</a></li>
<li><a href="4-8-ejercicios-2.html#ejercicios-2"><span class="toc-section-number">4.8</span> Ejercicios</a></li>
</ul></li>
<li><a href="5-modelado-estadístico.html#modelado-estadístico"><span class="toc-section-number">5</span> Modelado estadístico</a>
<ul>
<li><a href="5-1-regresión-lineal-simple.html#regresión-lineal-simple"><span class="toc-section-number">5.1</span> Regresión lineal simple</a>
<ul>
<li><a href="5-1-regresión-lineal-simple.html#regresión-con-una-variable-numérica"><span class="toc-section-number">5.1.1</span> Regresión con una variable numérica</a></li>
<li><a href="5-1-regresión-lineal-simple.html#revolviendo-los-residuos"><span class="toc-section-number">5.1.2</span> Revolviendo los residuos</a></li>
<li><a href="5-1-regresión-lineal-simple.html#regresión-con-una-variable-categórica"><span class="toc-section-number">5.1.3</span> Regresión con una variable categórica</a></li>
</ul></li>
<li><a href="5-2-regresión-con-múltiples-variables.html#regresión-con-múltiples-variables"><span class="toc-section-number">5.2</span> Regresión con múltiples variables</a></li>
<li><a href="5-3-ejercicios-3.html#ejercicios-3"><span class="toc-section-number">5.3</span> Ejercicios</a></li>
</ul></li>
<li><a href="6-información-geográfica-y-mapas.html#información-geográfica-y-mapas"><span class="toc-section-number">6</span> Información geográfica y mapas</a>
<ul>
<li><a href="6-1-los-datos-georreferenciados.html#los-datos-georreferenciados"><span class="toc-section-number">6.1</span> Los datos georreferenciados</a></li>
<li><a href="6-2-formatos-de-archivo.html#formatos-de-archivo"><span class="toc-section-number">6.2</span> Formatos de archivo</a></li>
<li><a href="6-3-explorando-un-archivo-con-información-geográfica.html#explorando-un-archivo-con-información-geográfica"><span class="toc-section-number">6.3</span> Explorando un archivo con información geográfica</a></li>
<li><a href="6-4-visualizando-información-geográfica.html#visualizando-información-geográfica"><span class="toc-section-number">6.4</span> Visualizando información geográfica</a></li>
<li><a href="6-5-volcando-en-el-mapa-información-de-múltiples-fuentes.html#volcando-en-el-mapa-información-de-múltiples-fuentes"><span class="toc-section-number">6.5</span> Volcando en el mapa información de múltiples fuentes</a></li>
<li><a href="6-6-combinando-capas-geográficas.html#combinando-capas-geográficas"><span class="toc-section-number">6.6</span> Combinando capas geográficas</a></li>
<li><a href="6-7-ejercicios-4.html#ejercicios-4"><span class="toc-section-number">6.7</span> Ejercicios</a></li>
</ul></li>
</ul>
</div>
</div>
</div>
<div class="row">
<div class="col-sm-12">
<div id="transformando-los-datos" class="section level2" number="3.3">
<h2><span class="header-section-number">3.3</span> Transformando los datos</h2>
<p>Habiendo revisado el contenido de un dataframe (y agregado alguna variable si hiciera falta), comenzamos a hacernos idea de los ajustes que necesita para que los datos tomen el formato que necesitamos. Estos ajustes pueden ser correcciones (por ejemplo, de errores de tipeo cuando se cargaron los datos), la creación de nuevas variables derivadas de las existentes, o un reordenamiento de los datos para simplificar nuestro trabajo.</p>
<p>Para hacer todo esto, y mucho más, vamos a aprender funciones que representan cinco verbos básicos para la transformación de datos:</p>
<ul>
<li><code>select()</code>: seleccionar -elegir- columnas por su nombre</li>
<li><code>filter()</code>: filtrar, es decir quedarse sólo con las filas que cumplan cierta condición</li>
<li><code>arrange()</code>: ordenar las filas de acuerdo a su contenido o algún otro índice</li>
<li><code>mutate()</code>: mutar -cambiar- un dataframe, modificando el contenido de sus columnas o creando columnas (es decir, variables) nuevas</li>
<li><code>summarise()</code>: producir sumarios -un valor extraído de muchos, por ejemplo el promedio- con el contenido de las columnas</li>
</ul>
<p>Estas funciones tienen una sintaxis, una forma de escribirse, uniforme. El primer argumento que toman siempre es un dataframe; los siguientes indican qué hacer con los datos. El resultado siempre es un nuevo dataframe.</p>
<p>Las funciones son parte de <a href="http://dplyr.tidyverse.org/">dplyr</a>, uno de los componentes de la familia de paquetes <a href="https://www.tidyverse.org/">Tidyverse</a>. Ya tenemos disponible todo lo necesario, activado cuando invocamos <code>library(tidyverse)</code> al comienzo.</p>
<p>Manos a la obra.</p>
<div id="seleccionar-columnas-con-select" class="section level3" number="3.3.1">
<h3><span class="header-section-number">3.3.1</span> Seleccionar columnas con <code>select()</code></h3>
<p>Muchas veces tendremos que lidiar con datasets con decenas de variables. Alguna que otra vez, con centenas. En esos casos el primer problema es librarnos de semejante cantidad de columnas, reteniendo sólo aquellas en las que estamos interesados. Para un dataset como el de reclamos de los ciudadanos, que tiene pocas columnas, select() no es tan importante. Aún así, podemos usar select() con fines demostrativos.</p>
<p>Sabemos que el dataset tiene 5 columnas:</p>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb68-1"><a href="3-3-transformando-los-datos.html#cb68-1"></a><span class="kw">names</span>(atencion_ciudadano)</span></code></pre></div>
<pre><code>## [1] &quot;PERIODO&quot;         &quot;RUBRO&quot;           &quot;TIPO_PRESTACION&quot; &quot;BARRIO&quot;          &quot;total&quot;           &quot;COMUNA&quot;</code></pre>
<p>Si quisiéramos sólo las que contienen el período y el total, las seleccionamos por nombre, a continuación del nombre del dataframe:</p>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb70-1"><a href="3-3-transformando-los-datos.html#cb70-1"></a>seleccion &lt;-<span class="st"> </span><span class="kw">select</span>(atencion_ciudadano, PERIODO, total)</span>
<span id="cb70-2"><a href="3-3-transformando-los-datos.html#cb70-2"></a></span>
<span id="cb70-3"><a href="3-3-transformando-los-datos.html#cb70-3"></a><span class="kw">head</span>(seleccion)</span></code></pre></div>
<pre><code>##   PERIODO total
## 1  201301     6
## 2  201301   172
## 3  201301    92
## 4  201301    45
## 5  201301    79
## 6  201301    10</code></pre>
<p>También podemos seleccionar por contigüidad, por ejemplo “todas las columnas que van de RUBRO a BARRIO”:</p>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb72-1"><a href="3-3-transformando-los-datos.html#cb72-1"></a>seleccion &lt;-<span class="st"> </span><span class="kw">select</span>(atencion_ciudadano, RUBRO<span class="op">:</span>BARRIO)</span>
<span id="cb72-2"><a href="3-3-transformando-los-datos.html#cb72-2"></a></span>
<span id="cb72-3"><a href="3-3-transformando-los-datos.html#cb72-3"></a><span class="kw">head</span>(seleccion)</span></code></pre></div>
<pre><code>##    RUBRO TIPO_PRESTACION    BARRIO
## 1 ACERAS         RECLAMO AGRONOMIA
## 2 ACERAS         RECLAMO   ALMAGRO
## 3 ACERAS         RECLAMO BALVANERA
## 4 ACERAS         RECLAMO  BARRACAS
## 5 ACERAS         RECLAMO  BELGRANO
## 6 ACERAS         RECLAMO      BOCA</code></pre>
<p>Y podemos seleccionar por omisión. Si nos interesara todo el contenido del dataset menos la variable RUBRO, usaríamos</p>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb74-1"><a href="3-3-transformando-los-datos.html#cb74-1"></a>seleccion &lt;-<span class="st"> </span><span class="kw">select</span>(atencion_ciudadano, <span class="op">-</span>RUBRO)</span>
<span id="cb74-2"><a href="3-3-transformando-los-datos.html#cb74-2"></a></span>
<span id="cb74-3"><a href="3-3-transformando-los-datos.html#cb74-3"></a><span class="kw">head</span>(seleccion)</span></code></pre></div>
<pre><code>##   PERIODO TIPO_PRESTACION    BARRIO total COMUNA
## 1  201301         RECLAMO AGRONOMIA     6     15
## 2  201301         RECLAMO   ALMAGRO   172      5
## 3  201301         RECLAMO BALVANERA    92      3
## 4  201301         RECLAMO  BARRACAS    45      4
## 5  201301         RECLAMO  BELGRANO    79     13
## 6  201301         RECLAMO      BOCA    10      4</code></pre>
<p>Al igual que con las selección por inclusión, podemos seleccionar por omisión de un rango de columnas contiguas (escritas entre paréntesis), o de varias columnas nombradas:</p>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb76-1"><a href="3-3-transformando-los-datos.html#cb76-1"></a>seleccion &lt;-<span class="st"> </span><span class="kw">select</span>(atencion_ciudadano, <span class="op">-</span>(TIPO_PRESTACION<span class="op">:</span>total))</span>
<span id="cb76-2"><a href="3-3-transformando-los-datos.html#cb76-2"></a></span>
<span id="cb76-3"><a href="3-3-transformando-los-datos.html#cb76-3"></a><span class="kw">head</span>(seleccion)</span></code></pre></div>
<pre><code>##   PERIODO  RUBRO COMUNA
## 1  201301 ACERAS     15
## 2  201301 ACERAS      5
## 3  201301 ACERAS      3
## 4  201301 ACERAS      4
## 5  201301 ACERAS     13
## 6  201301 ACERAS      4</code></pre>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb78-1"><a href="3-3-transformando-los-datos.html#cb78-1"></a>seleccion &lt;-<span class="st"> </span><span class="kw">select</span>(atencion_ciudadano, <span class="op">-</span>RUBRO, <span class="op">-</span>BARRIO)</span>
<span id="cb78-2"><a href="3-3-transformando-los-datos.html#cb78-2"></a></span>
<span id="cb78-3"><a href="3-3-transformando-los-datos.html#cb78-3"></a><span class="kw">head</span>(seleccion)</span></code></pre></div>
<pre><code>##   PERIODO TIPO_PRESTACION total COMUNA
## 1  201301         RECLAMO     6     15
## 2  201301         RECLAMO   172      5
## 3  201301         RECLAMO    92      3
## 4  201301         RECLAMO    45      4
## 5  201301         RECLAMO    79     13
## 6  201301         RECLAMO    10      4</code></pre>
</div>
<div id="filtrar-filas-con-filter" class="section level3" number="3.3.2">
<h3><span class="header-section-number">3.3.2</span> Filtrar filas con <code>filter()</code></h3>
<p>Una de las tareas más frecuentes en el análisis de datos es la de identificar observaciones que cumplen con determinada condición. <code>filter()</code> permite extraer subconjuntos del total en base a sus variables.</p>
<p>Por ejemplo, para seleccionar registros que correspondan a Retiro, ocurridos en el primer mes de 2014 (período 201401):</p>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb80-1"><a href="3-3-transformando-los-datos.html#cb80-1"></a>seleccion &lt;-<span class="st"> </span><span class="kw">filter</span>(atencion_ciudadano, BARRIO <span class="op">==</span><span class="st"> &quot;RETIRO&quot;</span>, PERIODO <span class="op">==</span><span class="st"> </span><span class="dv">201401</span>)</span>
<span id="cb80-2"><a href="3-3-transformando-los-datos.html#cb80-2"></a><span class="kw">head</span>(seleccion)</span></code></pre></div>
<pre><code>##   PERIODO               RUBRO TIPO_PRESTACION BARRIO total COMUNA
## 1  201401              ACERAS         RECLAMO RETIRO    10      1
## 2  201401           ALUMBRADO         RECLAMO RETIRO    34      1
## 3  201401           ALUMBRADO       SOLICITUD RETIRO     2      1
## 4  201401            ARBOLADO         RECLAMO RETIRO    10      1
## 5  201401            ARBOLADO       SOLICITUD RETIRO     3      1
## 6  201401 ATENCION AL PUBLICO           QUEJA RETIRO     3      1</code></pre>
<div id="comparaciones" class="section level4" number="3.3.2.1">
<h4><span class="header-section-number">3.3.2.1</span> Comparaciones</h4>
<p>Aquí hemos usado un recurso nuevo, la comparación. R provee una serie de símbolos que permite comparar valores entre sí:</p>
<pre><code>* ==   igual a 
* !=   no igual a 
* &gt;    mayor a 
* &gt;=   mayor o igual a 
* &lt;    menor a 
* &lt;=   menor o igual a </code></pre>
<p>Atención especial merece el símbolo que compara igualdad, <code>==</code>. Un error muy común es escribir <code>BARRIO = "RETIRO"</code>, (un sólo símbolo <code>=</code>) que le indica a R que guarde el valor “RETIRO” dentro de la variable BARRIO, en lugar de verificar si son iguales. Para ésto último, lo correcto es <code>BARRIO == "RETIRO"</code>, tal como lo usamos en el ejemplo de filter().</p>
<p>También hay que tener en cuenta el uso de comillas. Para que R no se confunda, cuando queramos usar valores de texto (de tipo <em>character</em>) los rodeamos con comillas para que quede claro que no nos referimos a una variable con ese nombre, si la hubiera, sino en forma literal a esa palabra o secuencia de texto. En el caso de los números, no hace falta el uso de comillas, ya que en R ningún nombre de variable puede comenzar con o estar compuesta sólo por números.</p>
<p>Filtrando los registros de períodos para los cuales se registran más de 100 incidentes:</p>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb83-1"><a href="3-3-transformando-los-datos.html#cb83-1"></a>seleccion &lt;-<span class="st"> </span><span class="kw">filter</span>(atencion_ciudadano, total <span class="op">&gt;</span><span class="st"> </span><span class="dv">100</span>)</span>
<span id="cb83-2"><a href="3-3-transformando-los-datos.html#cb83-2"></a><span class="kw">head</span>(seleccion)</span></code></pre></div>
<pre><code>##   PERIODO     RUBRO TIPO_PRESTACION    BARRIO total COMUNA
## 1  201301    ACERAS         RECLAMO   ALMAGRO   172      5
## 2  201301    ACERAS         RECLAMO CABALLITO   109      6
## 3  201301    ACERAS         RECLAMO    FLORES   111      7
## 4  201301    ACERAS         RECLAMO   PALERMO   113     14
## 5  201301 ALUMBRADO         RECLAMO   ALMAGRO   130      5
## 6  201301 ALUMBRADO         RECLAMO  BARRACAS   118      4</code></pre>
</div>
<div id="operadores-lógicos" class="section level4" number="3.3.2.2">
<h4><span class="header-section-number">3.3.2.2</span> Operadores lógicos</h4>
<p>Cuando le pasamos múltiples condiciones a filter(), la función devuelve las filas que cumplen con todas.</p>
<p>Por ejemplo, con</p>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb85-1"><a href="3-3-transformando-los-datos.html#cb85-1"></a>seleccion &lt;-<span class="st"> </span><span class="kw">filter</span>(atencion_ciudadano, PERIODO <span class="op">==</span><span class="st"> </span><span class="dv">201508</span>,  RUBRO <span class="op">==</span><span class="st"> &quot;SALUD&quot;</span>)</span>
<span id="cb85-2"><a href="3-3-transformando-los-datos.html#cb85-2"></a></span>
<span id="cb85-3"><a href="3-3-transformando-los-datos.html#cb85-3"></a><span class="kw">head</span>(seleccion)</span></code></pre></div>
<pre><code>##   PERIODO RUBRO TIPO_PRESTACION    BARRIO total COMUNA
## 1  201508 SALUD           QUEJA  BARRACAS     1      4
## 2  201508 SALUD           QUEJA CABALLITO     1      6
## 3  201508 SALUD           QUEJA   COGHLAN     1     12
## 4  201508 SALUD           QUEJA  RECOLETA     1      2</code></pre>
<p>obtenemos todos los registros cuyo rubro es “SALUD”, y cuyo período es 20108, agosto de 2015.</p>
<p>Siguiendo el mismo formato, si intentamos</p>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb87-1"><a href="3-3-transformando-los-datos.html#cb87-1"></a>seleccion &lt;-<span class="st"> </span><span class="kw">filter</span>(atencion_ciudadano, BARRIO <span class="op">==</span><span class="st"> &quot;RETIRO&quot;</span>, BARRIO <span class="op">==</span><span class="st"> &quot;PALERMO&quot;</span>)</span>
<span id="cb87-2"><a href="3-3-transformando-los-datos.html#cb87-2"></a></span>
<span id="cb87-3"><a href="3-3-transformando-los-datos.html#cb87-3"></a><span class="kw">head</span>(seleccion)</span></code></pre></div>
<pre><code>## [1] PERIODO         RUBRO           TIPO_PRESTACION BARRIO          total           COMUNA         
## &lt;0 rows&gt; (or 0-length row.names)</code></pre>
<p>obtenemos un conjunto vacío. ¿Por qué? Es debido a que ninguna observación cumple con todas las condiciones; el ningún registro el barrio es Retiro y es Palermo. ¡Suena razonable!. Para obtener registros ocurrido en Retiro <strong>ó</strong> en Palermo, usamos el operador lógico <code>|</code> que significa… “ó”.</p>
<div class="sourceCode" id="cb89"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb89-1"><a href="3-3-transformando-los-datos.html#cb89-1"></a>seleccion &lt;-<span class="st"> </span><span class="kw">filter</span>(atencion_ciudadano, BARRIO <span class="op">==</span><span class="st"> &quot;RETIRO&quot;</span> <span class="op">|</span><span class="st"> </span>BARRIO <span class="op">==</span><span class="st"> &quot;PALERMO&quot;</span>)</span>
<span id="cb89-2"><a href="3-3-transformando-los-datos.html#cb89-2"></a></span>
<span id="cb89-3"><a href="3-3-transformando-los-datos.html#cb89-3"></a><span class="kw">head</span>(seleccion)</span></code></pre></div>
<pre><code>##   PERIODO               RUBRO TIPO_PRESTACION  BARRIO total COMUNA
## 1  201301              ACERAS         RECLAMO PALERMO   113     14
## 2  201301              ACERAS         RECLAMO  RETIRO    15      1
## 3  201301              ACERAS       SOLICITUD PALERMO     2     14
## 4  201301 ACTOS DE CORRUPCION        DENUNCIA PALERMO     4     14
## 5  201301           ALUMBRADO         RECLAMO PALERMO    74     14
## 6  201301           ALUMBRADO         RECLAMO  RETIRO    15      1</code></pre>
<p>Se trata de la lógica de conjuntos, o lógica <em>booleana</em>, que con un poco de suerte recordamos de nuestra época de escolares. Los símbolos importantes son <code>&amp;</code>, <code>|</code>, y <code>!</code>: “y”, “ó”, y la negación que invierte preposiciones:</p>
<pre><code>* a &amp; b     a y b
* a | b     a ó b
* a &amp; !b    a, y no b
* !a &amp; b    no a, y b
* !(a &amp; b)  no (a y b) </code></pre>
<p>Hemos visto ejemplos de <code>a &amp; b</code> (<code>PERIODO == 201508,  RUBRO == "SALUD"</code>, que filter toma como un <code>&amp;</code>) y de <code>a | b</code> (<code>BARRIO == "RETIRO" | BARRIO == "PALERMO"</code>)</p>
<p>Un ejemplo de <code>a &amp; !b</code>, filas en las que el tipo de prestación sea “TRAMITE”, y en las que el rubro no sea “REGISTRO CIVIL”:</p>
<div class="sourceCode" id="cb92"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb92-1"><a href="3-3-transformando-los-datos.html#cb92-1"></a><span class="kw">filter</span>(atencion_ciudadano, TIPO_PRESTACION <span class="op">==</span><span class="st"> &quot;TRAMITE&quot;</span> <span class="op">&amp;</span><span class="st"> </span><span class="op">!</span>(RUBRO <span class="op">==</span><span class="st"> &quot;REGISTRO CIVIL&quot;</span>))</span></code></pre></div>
<p>Y como ejemplo de <code>!(a &amp; b)</code>, todas las filas excepto las de tipo “DENUNCIA”, y rubro “SEGURIDAD E HIGIENE”:</p>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb93-1"><a href="3-3-transformando-los-datos.html#cb93-1"></a>seleccion &lt;-<span class="st"> </span><span class="kw">filter</span>(atencion_ciudadano, <span class="op">!</span>(TIPO_PRESTACION <span class="op">==</span><span class="st"> &quot;DENUNCIA&quot;</span> <span class="op">&amp;</span><span class="st"> </span>RUBRO <span class="op">==</span><span class="st"> &quot;SEGURIDAD E HIGIENE&quot;</span>))</span>
<span id="cb93-2"><a href="3-3-transformando-los-datos.html#cb93-2"></a></span>
<span id="cb93-3"><a href="3-3-transformando-los-datos.html#cb93-3"></a><span class="kw">head</span>(seleccion)</span></code></pre></div>
<pre><code>##   PERIODO  RUBRO TIPO_PRESTACION    BARRIO total COMUNA
## 1  201301 ACERAS         RECLAMO AGRONOMIA     6     15
## 2  201301 ACERAS         RECLAMO   ALMAGRO   172      5
## 3  201301 ACERAS         RECLAMO BALVANERA    92      3
## 4  201301 ACERAS         RECLAMO  BARRACAS    45      4
## 5  201301 ACERAS         RECLAMO  BELGRANO    79     13
## 6  201301 ACERAS         RECLAMO      BOCA    10      4</code></pre>
</div>
</div>
<div id="ordenar-filas-con-arrange" class="section level3" number="3.3.3">
<h3><span class="header-section-number">3.3.3</span> Ordenar filas con <code>arrange()</code></h3>
<p>La función <code>arrange()</code> cambia el orden en el que aparecen las filas de un dataframe. Como primer parámetro toma un dataframe, al igual que el resto de los verbos de transformación que estamos aprendiendo. A continuación, espera un set de columnas para definir el orden.</p>
<p>Por ejemplo, para ordenar por total de registros:</p>
<div class="sourceCode" id="cb95"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb95-1"><a href="3-3-transformando-los-datos.html#cb95-1"></a>ordenado &lt;-<span class="st"> </span><span class="kw">arrange</span>(atencion_ciudadano, total)</span>
<span id="cb95-2"><a href="3-3-transformando-los-datos.html#cb95-2"></a></span>
<span id="cb95-3"><a href="3-3-transformando-los-datos.html#cb95-3"></a><span class="kw">head</span>(ordenado)</span></code></pre></div>
<pre><code>##   PERIODO  RUBRO TIPO_PRESTACION        BARRIO total COMUNA
## 1  201301 ACERAS         RECLAMO PUERTO MADERO     1      1
## 2  201301 ACERAS       SOLICITUD      BARRACAS     1      4
## 3  201301 ACERAS       SOLICITUD          BOCA     1      4
## 4  201301 ACERAS       SOLICITUD         BOEDO     1      5
## 5  201301 ACERAS       SOLICITUD       COGHLAN     1     12
## 6  201301 ACERAS       SOLICITUD  CONSTITUCION     1      1</code></pre>
<p>Si agregamos más columnas, se usan en orden para “desempatar”. Por ejemplo, si queremos que las filas con el mismo valor en <em>total</em> aparezcan en el orden alfabético del barrio que les corresponde, sólo necesitamos agregar esa columna:</p>
<div class="sourceCode" id="cb97"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb97-1"><a href="3-3-transformando-los-datos.html#cb97-1"></a>ordenado &lt;-<span class="st"> </span><span class="kw">arrange</span>(atencion_ciudadano, total, BARRIO)</span>
<span id="cb97-2"><a href="3-3-transformando-los-datos.html#cb97-2"></a></span>
<span id="cb97-3"><a href="3-3-transformando-los-datos.html#cb97-3"></a><span class="kw">head</span>(ordenado)</span></code></pre></div>
<pre><code>##   PERIODO           RUBRO TIPO_PRESTACION    BARRIO total COMUNA
## 1  201301       ALUMBRADO       SOLICITUD AGRONOMIA     1     15
## 2  201301 ATENCION SOCIAL         RECLAMO AGRONOMIA     1     15
## 3  201301 ESPACIO PUBLICO         RECLAMO AGRONOMIA     1     15
## 4  201301           QUEJA           QUEJA AGRONOMIA     1     15
## 5  201301   RECUPERADORES         RECLAMO AGRONOMIA     1     15
## 6  201301       SEGURIDAD         RECLAMO AGRONOMIA     1     15</code></pre>
<p>Si no se aclara lo contrario, el orden siempre es ascendente (de menor a mayor). Si quisiéramos orden de mayor a menor, usamos <code>desc()</code>:</p>
<div class="sourceCode" id="cb99"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb99-1"><a href="3-3-transformando-los-datos.html#cb99-1"></a>ordenado &lt;-<span class="st"> </span><span class="kw">arrange</span>(atencion_ciudadano, <span class="kw">desc</span>(total))</span>
<span id="cb99-2"><a href="3-3-transformando-los-datos.html#cb99-2"></a></span>
<span id="cb99-3"><a href="3-3-transformando-los-datos.html#cb99-3"></a><span class="kw">head</span>(ordenado)</span></code></pre></div>
<pre><code>##   PERIODO          RUBRO TIPO_PRESTACION      BARRIO total COMUNA
## 1  201502 REGISTRO CIVIL         TRAMITE   MONSERRAT 19221      1
## 2  201403 REGISTRO CIVIL         TRAMITE SAN NICOLAS 19209      1
## 3  201402 REGISTRO CIVIL         TRAMITE SAN NICOLAS 17032      1
## 4  201504 REGISTRO CIVIL         TRAMITE   MONSERRAT 16746      1
## 5  201503 REGISTRO CIVIL         TRAMITE   MONSERRAT 16730      1
## 6  201506 REGISTRO CIVIL         TRAMITE   MONSERRAT 14674      1</code></pre>
<div id="valores-faltantes" class="section level4" number="3.3.3.1">
<h4><span class="header-section-number">3.3.3.1</span> Valores faltantes</h4>
<p>En el último ejemplo, aparecen varias filas cuyo valor para la columna BARRIO es <code>NA</code>. R representa los valores ausentes, desconocidos, con <code>NA</code> (“no disponible”, del inglés <em>Not Available</em>). Hay que tener cuidado con los valores <code>NA</code>, porque la mayoría de las comparaciones y operaciones lógicas que los involucran resultan indefinidas. En la práctica:</p>
<p>¿Es 10 mayor a un valor desconocido?</p>
<div class="sourceCode" id="cb101"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb101-1"><a href="3-3-transformando-los-datos.html#cb101-1"></a><span class="dv">10</span> <span class="op">&gt;</span><span class="st"> </span><span class="ot">NA</span></span></code></pre></div>
<pre><code>## [1] NA</code></pre>
<p>R no sabe. (Nadie lo sabe, para ser justos)</p>
<p>¿A cuanto asciende la suma de 10 más un valor desconocido?</p>
<div class="sourceCode" id="cb103"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb103-1"><a href="3-3-transformando-los-datos.html#cb103-1"></a><span class="ot">NA</span> <span class="op">+</span><span class="st"> </span><span class="dv">10</span></span></code></pre></div>
<pre><code>## [1] NA</code></pre>
<p>Y en particular… ¿es un valor desconocido igual a otro valor desconocido?</p>
<div class="sourceCode" id="cb105"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb105-1"><a href="3-3-transformando-los-datos.html#cb105-1"></a><span class="ot">NA</span> <span class="op">==</span><span class="st"> </span><span class="ot">NA</span></span></code></pre></div>
<pre><code>## [1] NA</code></pre>
<p>Por supuesto, la respuesta es desconocida también. La insistencia de R en no definir operaciones que involucran NA’s podría parecer irritante a primera vista, pero en realidad nos hace un favor. Al evitar extraer conclusiones cuando trata con datos faltantes, nos evita caer en errores garrafales en los casos en que analizamos y comparamos datos incompletos. Además, podemos preguntar a R si un valor es desconocido, y allí si contesta con seguridad. La función requerida es <code>is.na()</code>.</p>
<div class="sourceCode" id="cb107"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb107-1"><a href="3-3-transformando-los-datos.html#cb107-1"></a>desconocido &lt;-<span class="st"> </span><span class="ot">NA</span></span>
<span id="cb107-2"><a href="3-3-transformando-los-datos.html#cb107-2"></a></span>
<span id="cb107-3"><a href="3-3-transformando-los-datos.html#cb107-3"></a><span class="kw">is.na</span>(desconocido)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<p>Algo más a tener en cuenta con los valores desconocidos es cómo son interpretados cuando usamos funciones de transformación de datos. Por ejemplo, <code>filter()</code> ignora las filas que contienen NA’s en la variable que usa para filtrar. <code>arrange()</code> muestra las filas con NA’s en el campo por el que ordena, pero todas al final.</p>
</div>
</div>
<div id="agregar-nuevas-variables-con-mutate" class="section level3" number="3.3.4">
<h3><span class="header-section-number">3.3.4</span> Agregar nuevas variables con <code>mutate()</code></h3>
<p>Recurrimos a la función <code>mutate()</code> cuando queremos agregarle columnas adicionales a nuestro dataframe, en general en base a los valores de las columnas ya existentes. Vamos a ilustrarlo con un ejemplo sencillo. Imaginemos que tenemos el siguiente dataset:</p>
<div class="sourceCode" id="cb109"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb109-1"><a href="3-3-transformando-los-datos.html#cb109-1"></a>circulos &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">nombre =</span> <span class="kw">c</span>(<span class="st">&quot;Círculo 1&quot;</span>, <span class="st">&quot;Círculo 2&quot;</span>, <span class="st">&quot;Círculo 3&quot;</span>),</span>
<span id="cb109-2"><a href="3-3-transformando-los-datos.html#cb109-2"></a>                       tamaño =<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Pequeño&quot;</span>, <span class="st">&quot;Mediano&quot;</span>, <span class="st">&quot;Grande&quot;</span>),</span>
<span id="cb109-3"><a href="3-3-transformando-los-datos.html#cb109-3"></a>                       <span class="dt">radio  =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">5</span>))</span>
<span id="cb109-4"><a href="3-3-transformando-los-datos.html#cb109-4"></a></span>
<span id="cb109-5"><a href="3-3-transformando-los-datos.html#cb109-5"></a>circulos</span></code></pre></div>
<pre><code>##      nombre  tamaño radio
## 1 Círculo 1 Pequeño     1
## 2 Círculo 2 Mediano     3
## 3 Círculo 3  Grande     5</code></pre>
<p>Podemos agregar una columna con el área de cada círculo con mutate():</p>
<div class="sourceCode" id="cb111"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb111-1"><a href="3-3-transformando-los-datos.html#cb111-1"></a><span class="kw">mutate</span>(circulos, <span class="dt">area =</span> <span class="fl">3.1416</span> <span class="op">*</span><span class="st"> </span>radio<span class="op">^</span><span class="dv">2</span>)</span></code></pre></div>
<pre><code>##      nombre  tamaño radio    area
## 1 Círculo 1 Pequeño     1  3.1416
## 2 Círculo 2 Mediano     3 28.2744
## 3 Círculo 3  Grande     5 78.5400</code></pre>
<p>Usando mutate(), definimos la columna “area”, indicando que su contenido será el valor de la columna “radio” en cada registro puesto en la fórmula del área de un círculo. Los operadores aritméticos (<code>+</code>, <code>-</code>, <code>*</code>, <code>/</code>, <code>^</code>) son con frecuencia útiles para usar en conjunto con mutate().</p>
<p>Volvamos ahora a nuestro dataframe con datos de reclamos. Supongamos que nos interesa agregar columnas con el mes y el año de cada registro. La columna período, con valores del tipo “201301”, contiene la información necesaria para derivar estas dos nuevas variables. Para separar la parte del año de la parte del mes, la función <code>substr()</code>, que extrae porciones de una variable de texto, nos va a dar una mano. La usamos así: el primer parámetro es una secuencia de caracteres, y los dos siguientes indican donde queremos que empiece y termine la porción a extraer.</p>
<div class="sourceCode" id="cb113"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb113-1"><a href="3-3-transformando-los-datos.html#cb113-1"></a>atencion_ciudadano &lt;-<span class="st"> </span><span class="kw">mutate</span>(atencion_ciudadano,</span>
<span id="cb113-2"><a href="3-3-transformando-los-datos.html#cb113-2"></a>                             AÑO =<span class="st"> </span><span class="kw">substr</span>(PERIODO, <span class="dv">1</span>, <span class="dv">4</span>),</span>
<span id="cb113-3"><a href="3-3-transformando-los-datos.html#cb113-3"></a>                             <span class="dt">MES =</span> <span class="kw">substr</span>(PERIODO, <span class="dv">5</span>, <span class="dv">6</span>))</span>
<span id="cb113-4"><a href="3-3-transformando-los-datos.html#cb113-4"></a>                                </span>
<span id="cb113-5"><a href="3-3-transformando-los-datos.html#cb113-5"></a><span class="kw">head</span>(atencion_ciudadano) </span></code></pre></div>
<pre><code>##   PERIODO  RUBRO TIPO_PRESTACION    BARRIO total COMUNA  AÑO MES
## 1  201301 ACERAS         RECLAMO AGRONOMIA     6     15 2013  01
## 2  201301 ACERAS         RECLAMO   ALMAGRO   172      5 2013  01
## 3  201301 ACERAS         RECLAMO BALVANERA    92      3 2013  01
## 4  201301 ACERAS         RECLAMO  BARRACAS    45      4 2013  01
## 5  201301 ACERAS         RECLAMO  BELGRANO    79     13 2013  01
## 6  201301 ACERAS         RECLAMO      BOCA    10      4 2013  01</code></pre>
</div>
<div id="extraer-sumarios-con-summarise" class="section level3" number="3.3.5">
<h3><span class="header-section-number">3.3.5</span> Extraer sumarios con <code>summarise()</code></h3>
<p>Llegamos al último de los verbos fundamentales para transformar datos. <code>summarise()</code> (por “resumir” en inglés) toma un dataframe completo y lo resume un una sola fila, de acuerdo a la operación que indiquemos. Por ejemplo, el promedio de la columna “total”:</p>
<div class="sourceCode" id="cb115"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb115-1"><a href="3-3-transformando-los-datos.html#cb115-1"></a><span class="kw">summarise</span>(atencion_ciudadano, <span class="dt">promedio =</span> <span class="kw">mean</span>(total))</span></code></pre></div>
<pre><code>##   promedio
## 1  34.8478</code></pre>
<p>Por si sola, <code>summarise()</code> no es de mucha ayuda. La gracia está en combinarla con <code>group_by()</code>, que cambia la unidad de análisis del dataframe completo a grupos individuales. Usar <code>summarise()</code> sobre un dataframe al que antes agrupamos con <code>group_by</code> resulta en resúmenes “por grupo”.</p>
<div class="sourceCode" id="cb117"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb117-1"><a href="3-3-transformando-los-datos.html#cb117-1"></a>agrupado &lt;-<span class="st"> </span><span class="kw">group_by</span>(atencion_ciudadano, AÑO)</span>
<span id="cb117-2"><a href="3-3-transformando-los-datos.html#cb117-2"></a></span>
<span id="cb117-3"><a href="3-3-transformando-los-datos.html#cb117-3"></a><span class="kw">summarise</span>(agrupado, <span class="dt">promedio_totales =</span> <span class="kw">mean</span>(total))</span></code></pre></div>
<pre><code>## # A tibble: 3 × 2
##   AÑO   promedio_totales
##   &lt;chr&gt;            &lt;dbl&gt;
## 1 2013              29.5
## 2 2014              30.2
## 3 2015              45.4</code></pre>
<p>Podemos agrupar por múltiples columnas, generando más subgrupos; por ejemplo, promedios por por año y mes…</p>
<div class="sourceCode" id="cb119"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb119-1"><a href="3-3-transformando-los-datos.html#cb119-1"></a>agrupado &lt;-<span class="st"> </span><span class="kw">group_by</span>(atencion_ciudadano, AÑO, MES)</span>
<span id="cb119-2"><a href="3-3-transformando-los-datos.html#cb119-2"></a></span>
<span id="cb119-3"><a href="3-3-transformando-los-datos.html#cb119-3"></a>sumario &lt;-<span class="st"> </span><span class="kw">summarise</span>(agrupado, <span class="dt">promedio =</span> <span class="kw">mean</span>(total))</span></code></pre></div>
<pre><code>## `summarise()` has grouped output by &#39;AÑO&#39;. You can override using the `.groups` argument.</code></pre>
<div class="sourceCode" id="cb121"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb121-1"><a href="3-3-transformando-los-datos.html#cb121-1"></a><span class="kw">head</span>(sumario)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 3
## # Groups:   AÑO [1]
##   AÑO   MES   promedio
##   &lt;chr&gt; &lt;chr&gt;    &lt;dbl&gt;
## 1 2013  01        25.1
## 2 2013  02        26.1
## 3 2013  03        26.9
## 4 2013  04        29.5
## 5 2013  05        28.0
## 6 2013  06        28.9</code></pre>
<p>… o por año, mes y barrio:</p>
<div class="sourceCode" id="cb123"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb123-1"><a href="3-3-transformando-los-datos.html#cb123-1"></a>agrupado &lt;-<span class="st"> </span><span class="kw">group_by</span>(atencion_ciudadano, AÑO, MES, BARRIO)</span>
<span id="cb123-2"><a href="3-3-transformando-los-datos.html#cb123-2"></a></span>
<span id="cb123-3"><a href="3-3-transformando-los-datos.html#cb123-3"></a>sumario &lt;-<span class="st"> </span><span class="kw">summarise</span>(agrupado, <span class="dt">promedio =</span> <span class="kw">mean</span>(total))</span></code></pre></div>
<pre><code>## `summarise()` has grouped output by &#39;AÑO&#39;, &#39;MES&#39;. You can override using the `.groups` argument.</code></pre>
<div class="sourceCode" id="cb125"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb125-1"><a href="3-3-transformando-los-datos.html#cb125-1"></a><span class="kw">head</span>(sumario)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 4
## # Groups:   AÑO, MES [1]
##   AÑO   MES   BARRIO    promedio
##   &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;        &lt;dbl&gt;
## 1 2013  01    AGRONOMIA    14.6 
## 2 2013  01    ALMAGRO      29.5 
## 3 2013  01    BALVANERA    23.6 
## 4 2013  01    BARRACAS     19.4 
## 5 2013  01    BELGRANO     24.4 
## 6 2013  01    BOCA          9.97</code></pre>
<p>Con <code>summarise()</code> podemos usar cualquier función que tome una lista de valores y devuelva un sólo restado. Para empezar, algunas de las que más podrían ayudarnos son:</p>
<pre><code>* `mean()`: Obtiene el promedio de los valores
* `sum()`: Obtiene la suma
* `min()`: Obtiene el valor más bajo
* `max()`: Obtiene el valor más alto</code></pre>
</div>
<div id="bonus-el-operador-pipe" class="section level3" number="3.3.6">
<h3><span class="header-section-number">3.3.6</span> ¡BONUS! El operador “pipe”: <code>%&gt;%</code></h3>
<p>Antes de terminar, vamos a presentar una herramienta más: el operador <em>pipe</em> (pronúnciese “paip”, es el término en inglés que significa “tubo”).</p>
<p>El pipe es un operador: un símbolo que relaciona dos entidades. Dicho en forma más simple, el pipe de R, cuyo símbolo es <code>%&gt;%</code> está en familia con otros operadores más convencionales, como <code>+</code>, <code>-</code> o <code>/</code>. Y al igual que los otros operadores, entrega un resultado en base a los operandos que recibe. Ahora bien… ¿Para qué sirve? En resumidas cuentas, hace que el código necesario para realizar una serie de operaciones de transformación de datos sea mucho más simple de escribir y de interpretar.</p>
<p>Por ejemplo, si quisiéramos obtener el top 5 de los barrios que más reclamos y denuncias de los ciudadanos han registrado durante 2015, la forma de lograrlo en base a lo que ya sabemos sería así:</p>
<pre><code>1. Filtramos los datos para aislar los registros del 2014;
2. agrupamos por Barrio;
3. hacemos un sumario, creando una variable resumen que contiene la suma de los registros para cada barrio;
4. los ordenamos en forma descendiente,
5. mostramos sólo los primeros 5 (esto se puede hacer con la función `head()`, aclarando cuantas filas queremos ver)</code></pre>
<p>En código:</p>
<div class="sourceCode" id="cb129"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb129-1"><a href="3-3-transformando-los-datos.html#cb129-1"></a>solo2014 &lt;-<span class="st"> </span><span class="kw">filter</span>(atencion_ciudadano, AÑO <span class="op">==</span><span class="st"> </span><span class="dv">2014</span>)</span>
<span id="cb129-2"><a href="3-3-transformando-los-datos.html#cb129-2"></a></span>
<span id="cb129-3"><a href="3-3-transformando-los-datos.html#cb129-3"></a>solo2014_agrupado_barrio &lt;-<span class="st"> </span><span class="kw">group_by</span>(solo2014, BARRIO)</span>
<span id="cb129-4"><a href="3-3-transformando-los-datos.html#cb129-4"></a></span>
<span id="cb129-5"><a href="3-3-transformando-los-datos.html#cb129-5"></a>total_por_barrio_<span class="dv">2014</span> &lt;-<span class="st"> </span><span class="kw">summarise</span>(solo2014_agrupado_barrio, <span class="dt">total =</span> <span class="kw">sum</span>(total))</span>
<span id="cb129-6"><a href="3-3-transformando-los-datos.html#cb129-6"></a></span>
<span id="cb129-7"><a href="3-3-transformando-los-datos.html#cb129-7"></a>total_por_barrio_<span class="dv">2014</span>_ordenado &lt;-<span class="st"> </span><span class="kw">arrange</span>(total_por_barrio_<span class="dv">2014</span>, <span class="kw">desc</span>(total))</span>
<span id="cb129-8"><a href="3-3-transformando-los-datos.html#cb129-8"></a></span>
<span id="cb129-9"><a href="3-3-transformando-los-datos.html#cb129-9"></a><span class="kw">head</span>(total_por_barrio_<span class="dv">2014</span>_ordenado, <span class="dv">5</span>)</span></code></pre></div>
<pre><code>## # A tibble: 5 × 2
##   BARRIO        total
##   &lt;chr&gt;         &lt;int&gt;
## 1 SAN NICOLAS  180956
## 2 PALERMO       22569
## 3 CABALLITO     19706
## 4 FLORES        15919
## 5 VILLA DEVOTO  15720</code></pre>
<p>¡Funciona! Pero… el problema es que hemos generado un puñado de variables (“solo2014”, “solo2014_agrupado_barrio”, etc) que, es probable, no volveremos a usar. Además de ser inútiles una vez obtenido el resultado buscado, estas variables intermedias requieren que las nombremos. Decidir el nombre de estas variables que no nos importan toma tiempo (sobre todo cuando producimos muchas), y nos distrae de lo importante, que es el análisis.</p>
<p>El pipe, <code>%&gt;%</code>, permite encadenar operaciones, conectando el resultado de una como el dato de entrada de la siguiente. La misma secuencia que realizamos antes puede resolverse con pipes, quedando así:</p>
<div class="sourceCode" id="cb131"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb131-1"><a href="3-3-transformando-los-datos.html#cb131-1"></a>atencion_ciudadano <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb131-2"><a href="3-3-transformando-los-datos.html#cb131-2"></a><span class="st">    </span><span class="kw">filter</span>(AÑO <span class="op">==</span><span class="st"> </span><span class="dv">2014</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb131-3"><a href="3-3-transformando-los-datos.html#cb131-3"></a><span class="st">    </span><span class="kw">group_by</span>(BARRIO) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb131-4"><a href="3-3-transformando-los-datos.html#cb131-4"></a><span class="st">    </span><span class="kw">summarise</span>(<span class="dt">total =</span> <span class="kw">sum</span>(total)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb131-5"><a href="3-3-transformando-los-datos.html#cb131-5"></a><span class="st">    </span><span class="kw">arrange</span>(<span class="kw">desc</span>(total)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb131-6"><a href="3-3-transformando-los-datos.html#cb131-6"></a><span class="st">    </span><span class="kw">head</span>(<span class="dv">5</span>)</span></code></pre></div>
<pre><code>## # A tibble: 5 × 2
##   BARRIO        total
##   &lt;chr&gt;         &lt;int&gt;
## 1 SAN NICOLAS  180956
## 2 PALERMO       22569
## 3 CABALLITO     19706
## 4 FLORES        15919
## 5 VILLA DEVOTO  15720</code></pre>
<p>Una manera de pronunciar <code>%&gt;%</code> cuando leemos código es “y luego…”. Algo así como “tomamos el dataframe”atencion_ciudadano" y luego filtramos los registros del año 2014, y luego agrupamos por barrio, y luego calculamos el total de registros para cada grupo, y luego los ordenamos en forma descendente por total, y luego vemos los cinco primeros".</p>
<p>El uso de pipes permite concentrarse en las operaciones de transformación, y no en lo que está siendo transformado en cada paso. Esto hace al código mucho más sencillo de leer e interpretar. En el ejemplo con pipe, sólo tuvimos que nombrar un dataframe con el cual trabajar un única vez, al principio.</p>
<p>Detrás de escena, <code>x %&gt;% f(y)</code> se transforma en <code>f(x, y)</code>. Por eso,</p>
<div class="sourceCode" id="cb133"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb133-1"><a href="3-3-transformando-los-datos.html#cb133-1"></a><span class="kw">filter</span>(atencion_ciudadano, AÑO <span class="op">==</span><span class="st"> </span><span class="dv">2014</span>)</span></code></pre></div>
<p>es equivalente a</p>
<div class="sourceCode" id="cb134"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb134-1"><a href="3-3-transformando-los-datos.html#cb134-1"></a>atencion_ciudadano <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(AÑO <span class="op">==</span><span class="st"> </span><span class="dv">2014</span>)</span></code></pre></div>
<p>Trabajar con pipes es una de las ventajas que hacen de R un lenguaje muy expresivo y cómodo para manipular datos, y a partir de aquí lo usaremos de forma habitual.</p>
<p>Con esto cerramos la sección de transformación de datos. Las técnicas para examinar un dataframe, como <code>sumamry()</code> nos permiten entender de forma rápida con que clase de variables vamos a trabajar. Los cinco verbos de manipulación que aprendimos, usados en conjunto, brindan una enorme capacidad para adaptar el formato de los datos a nuestras necesidades. Y el operador pipe nos ayuda a escribir nuestro código de forma sucinta y fácil de interpretar.</p>
<p>A medida que vayamos progresando en nuestra familiaridad con las funciones -y agregando técnicas nuevas- vamos a ser capaces de procesar grandes cantidades de datos con soltura. Y obtener en pocos minutos lo que de otra forma, sin herramientas computacionales, tardaría días o sería inviable por lo tedioso.</p>
</div>
</div>
<p style="text-align: center;">
<a href="3-2-cruzando-variables-la-operación-join.html"><button class="btn btn-default">Previous</button></a>
<a href="3-4-ejercicios-1.html"><button class="btn btn-default">Next</button></a>
</p>
</div>
</div>


</div>

<script>

// add bootstrap table styles to pandoc tables
$(document).ready(function () {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
});

</script>

</body>
</html>
