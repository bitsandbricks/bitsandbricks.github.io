<!DOCTYPE html>
<html lang="es" xml:lang="es">
<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta property="og:title" content="6.5 Volcando en el mapa información de múltiples fuentes | Ciencia de Datos para Gente Sociable" />
<meta property="og:type" content="book" />



<meta name="github-repo" content="bitsandbricks/datos_sociables" />

<meta name="author" content="Antonio Vazquez Brust" />

<meta name="date" content="2021-08-05" />

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  TeX: { equationNumbers: { autoNumber: "AMS" } }
});
</script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js" type="text/javascript"></script>

<meta name="description" content="6.5 Volcando en el mapa información de múltiples fuentes | Ciencia de Datos para Gente Sociable">

<title>6.5 Volcando en el mapa información de múltiples fuentes | Ciencia de Datos para Gente Sociable</title>

<script src="libs/header-attrs-2.9/header-attrs.js"></script>
<script src="libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="libs/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="libs/navigation-1.1/tabsets.js"></script>
<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>




<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
/* show arrow before summary tag as in bootstrap
TODO: remove if boostrap in updated in html_document (rmarkdown#1485) */
details > summary {
  display: list-item;
  cursor: pointer;
}
</style>
</head>

<body>

<div class="container-fluid main-container">


<div class="row">
<div class="col-sm-12">
<div id="TOC">
<ul>
<li><a href="index.html#section"></a>
<ul>
<li><a href="para-quién-es-esto.html#para-quién-es-esto">¿Para quién es esto?</a></li>
<li><a href="antes-de-empezar.html#antes-de-empezar">Antes de empezar</a></li>
</ul></li>
<li><a href="1-qué-es-la-ciencia-de-datos.html#qué-es-la-ciencia-de-datos"><span class="toc-section-number">1</span> ¿Qué es la ciencia de datos?</a>
<ul>
<li><a href="1-1-qué-significa-hacer-ciencia-de-datos.html#qué-significa-hacer-ciencia-de-datos"><span class="toc-section-number">1.1</span> ¿Qué significa hacer ciencia de datos?</a></li>
</ul></li>
<li><a href="2-una-presentación-a-toda-marcha-de-r.html#una-presentación-a-toda-marcha-de-r"><span class="toc-section-number">2</span> Una presentación a toda marcha de R</a>
<ul>
<li><a href="2-1-nuestro-primer-proyecto-en-r.html#nuestro-primer-proyecto-en-r"><span class="toc-section-number">2.1</span> Nuestro primer proyecto en R</a>
<ul>
<li><a href="2-1-nuestro-primer-proyecto-en-r.html#a-investigar-cual-es-la-diferencia-en-mortalidad-infantil-entre-el-sur-y-el-norte-de-la-ciudad-autónoma-de-buenos-aires"><span class="toc-section-number">2.1.1</span> A investigar: ¿Cual es la diferencia en mortalidad infantil entre el sur y el norte de la Ciudad Autónoma de Buenos Aires?</a></li>
<li><a href="2-1-nuestro-primer-proyecto-en-r.html#crear-un-proyecto-en-rstudio"><span class="toc-section-number">2.1.2</span> Crear un proyecto en RStudio</a></li>
<li><a href="2-1-nuestro-primer-proyecto-en-r.html#escribiendo-un-script"><span class="toc-section-number">2.1.3</span> Escribiendo un script</a></li>
<li><a href="2-1-nuestro-primer-proyecto-en-r.html#cargar-los-datos"><span class="toc-section-number">2.1.4</span> Cargar los datos</a></li>
</ul></li>
<li><a href="2-2-visualización-la-exploración-gráfica-de-la-información.html#visualización-la-exploración-gráfica-de-la-información"><span class="toc-section-number">2.2</span> Visualización: la exploración gráfica de la información</a>
<ul>
<li><a href="2-2-visualización-la-exploración-gráfica-de-la-información.html#haciendo-mapas"><span class="toc-section-number">2.2.1</span> Haciendo mapas</a></li>
<li><a href="2-2-visualización-la-exploración-gráfica-de-la-información.html#agregando-datos"><span class="toc-section-number">2.2.2</span> Agregando datos</a></li>
</ul></li>
<li><a href="2-3-el-veredicto-final.html#el-veredicto-final"><span class="toc-section-number">2.3</span> El veredicto final</a>
<ul>
<li><a href="2-3-el-veredicto-final.html#cuál-es-la-diferencia-en-mortalidad-infantil-entre-el-sur-y-el-norte-de-la-ciudad-autónoma-de-buenos-aires"><span class="toc-section-number">2.3.1</span> ¿Cuál es la diferencia en mortalidad infantil entre el sur y el norte de la Ciudad Autónoma de Buenos Aires?</a></li>
</ul></li>
<li><a href="2-4-ejercicios.html#ejercicios"><span class="toc-section-number">2.4</span> Ejercicios</a></li>
</ul></li>
<li><a href="3-poniendo-los-datos-en-forma.html#poniendo-los-datos-en-forma"><span class="toc-section-number">3</span> Poniendo los datos en forma</a>
<ul>
<li><a href="3-1-primeros-pasos-al-examinar-un-conjunto-de-datos-nuevo.html#primeros-pasos-al-examinar-un-conjunto-de-datos-nuevo"><span class="toc-section-number">3.1</span> Primeros pasos al examinar un conjunto de datos nuevo</a></li>
<li><a href="3-2-cruzando-variables-la-operación-join.html#cruzando-variables-la-operación-join"><span class="toc-section-number">3.2</span> Cruzando variables: la operación <code>join</code></a></li>
<li><a href="3-3-transformando-los-datos.html#transformando-los-datos"><span class="toc-section-number">3.3</span> Transformando los datos</a>
<ul>
<li><a href="3-3-transformando-los-datos.html#seleccionar-columnas-con-select"><span class="toc-section-number">3.3.1</span> Seleccionar columnas con <code>select()</code></a></li>
<li><a href="3-3-transformando-los-datos.html#filtrar-filas-con-filter"><span class="toc-section-number">3.3.2</span> Filtrar filas con <code>filter()</code></a></li>
<li><a href="3-3-transformando-los-datos.html#ordenar-filas-con-arrange"><span class="toc-section-number">3.3.3</span> Ordenar filas con <code>arrange()</code></a></li>
<li><a href="3-3-transformando-los-datos.html#agregar-nuevas-variables-con-mutate"><span class="toc-section-number">3.3.4</span> Agregar nuevas variables con <code>mutate()</code></a></li>
<li><a href="3-3-transformando-los-datos.html#extraer-sumarios-con-summarise"><span class="toc-section-number">3.3.5</span> Extraer sumarios con <code>summarise()</code></a></li>
<li><a href="3-3-transformando-los-datos.html#bonus-el-operador-pipe"><span class="toc-section-number">3.3.6</span> ¡BONUS! El operador “pipe”: <code>%&gt;%</code></a></li>
</ul></li>
<li><a href="3-4-ejercicios-1.html#ejercicios-1"><span class="toc-section-number">3.4</span> Ejercicios</a></li>
</ul></li>
<li><a href="4-visualización.html#visualización"><span class="toc-section-number">4</span> Visualización</a>
<ul>
<li><a href="4-1-una-buena-visualización-para-empezar-el-scatterplot.html#una-buena-visualización-para-empezar-el-scatterplot"><span class="toc-section-number">4.1</span> Una buena visualización para empezar: el <em>scatterplot</em></a></li>
<li><a href="4-2-ajustando-color-y-tamaño.html#ajustando-color-y-tamaño"><span class="toc-section-number">4.2</span> Ajustando color y tamaño</a></li>
<li><a href="4-3-facetado.html#facetado"><span class="toc-section-number">4.3</span> Facetado</a></li>
<li><a href="4-4-gráficos-de-barras.html#gráficos-de-barras"><span class="toc-section-number">4.4</span> Gráficos de barras</a></li>
<li><a href="4-5-histogramas.html#histogramas"><span class="toc-section-number">4.5</span> Histogramas</a></li>
<li><a href="4-6-preparando-una-visualización-para-compartir.html#preparando-una-visualización-para-compartir"><span class="toc-section-number">4.6</span> Preparando una visualización para compartir</a></li>
<li><a href="4-7-otras-visualizaciones.html#otras-visualizaciones"><span class="toc-section-number">4.7</span> Otras visualizaciones</a></li>
<li><a href="4-8-ejercicios-2.html#ejercicios-2"><span class="toc-section-number">4.8</span> Ejercicios</a></li>
</ul></li>
<li><a href="5-modelado-estadístico.html#modelado-estadístico"><span class="toc-section-number">5</span> Modelado estadístico</a>
<ul>
<li><a href="5-1-regresión-lineal-simple.html#regresión-lineal-simple"><span class="toc-section-number">5.1</span> Regresión lineal simple</a>
<ul>
<li><a href="5-1-regresión-lineal-simple.html#regresión-con-una-variable-numérica"><span class="toc-section-number">5.1.1</span> Regresión con una variable numérica</a></li>
<li><a href="5-1-regresión-lineal-simple.html#revolviendo-los-residuos"><span class="toc-section-number">5.1.2</span> Revolviendo los residuos</a></li>
<li><a href="5-1-regresión-lineal-simple.html#regresión-con-una-variable-categórica"><span class="toc-section-number">5.1.3</span> Regresión con una variable categórica</a></li>
</ul></li>
<li><a href="5-2-regresión-con-múltiples-variables.html#regresión-con-múltiples-variables"><span class="toc-section-number">5.2</span> Regresión con múltiples variables</a></li>
<li><a href="5-3-ejercicios-3.html#ejercicios-3"><span class="toc-section-number">5.3</span> Ejercicios</a></li>
</ul></li>
<li><a href="6-información-geográfica-y-mapas.html#información-geográfica-y-mapas"><span class="toc-section-number">6</span> Información geográfica y mapas</a>
<ul>
<li><a href="6-1-los-datos-georreferenciados.html#los-datos-georreferenciados"><span class="toc-section-number">6.1</span> Los datos georreferenciados</a></li>
<li><a href="6-2-formatos-de-archivo.html#formatos-de-archivo"><span class="toc-section-number">6.2</span> Formatos de archivo</a></li>
<li><a href="6-3-explorando-un-archivo-con-información-geográfica.html#explorando-un-archivo-con-información-geográfica"><span class="toc-section-number">6.3</span> Explorando un archivo con información geográfica</a></li>
<li><a href="6-4-visualizando-información-geográfica.html#visualizando-información-geográfica"><span class="toc-section-number">6.4</span> Visualizando información geográfica</a></li>
<li><a href="6-5-volcando-en-el-mapa-información-de-múltiples-fuentes.html#volcando-en-el-mapa-información-de-múltiples-fuentes"><span class="toc-section-number">6.5</span> Volcando en el mapa información de múltiples fuentes</a></li>
<li><a href="6-6-combinando-capas-geográficas.html#combinando-capas-geográficas"><span class="toc-section-number">6.6</span> Combinando capas geográficas</a></li>
<li><a href="6-7-ejercicios-4.html#ejercicios-4"><span class="toc-section-number">6.7</span> Ejercicios</a></li>
</ul></li>
</ul>
</div>
</div>
</div>
<div class="row">
<div class="col-sm-12">
<div id="volcando-en-el-mapa-información-de-múltiples-fuentes" class="section level2" number="6.5">
<h2><span class="header-section-number">6.5</span> Volcando en el mapa información de múltiples fuentes</h2>
<p>En algunos casos, un archivo con información geográfica contiene todos los datos que necesitamos. Pero lo habitual es que el archivo sólo brinde la ubicación y fronteras de nuestras unidades de análisis, de manera que necesitamos agregarle los datos que hemos obtenido de otras fuentes y queremos proyectar en un mapa.</p>
<p>En el capítulo 2 aprendimos a usar la función <code>left_join()</code> para combinar tablas. Dado que los datos espaciales cargados vía <code>sf()</code> son dataframes -tablas-, podemos usarla para agregar variables a nuestros radios censales. Por ejemplo, las del dataset de interacciones de la ciudadanía con la ciudad.</p>
<p>Lo cargamos,</p>
<div class="sourceCode" id="cb261"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb261-1"><a href="6-5-volcando-en-el-mapa-información-de-múltiples-fuentes.html#cb261-1"></a>atencion_ciudadano &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;http://bitsandbricks.github.io/data/gcba_suaci_comunas.csv&quot;</span>)</span></code></pre></div>
<p>y recordamos que sus variables son:</p>
<div class="sourceCode" id="cb262"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb262-1"><a href="6-5-volcando-en-el-mapa-información-de-múltiples-fuentes.html#cb262-1"></a><span class="kw">names</span>(atencion_ciudadano)</span></code></pre></div>
<pre><code>## [1] &quot;PERIODO&quot;         &quot;RUBRO&quot;           &quot;TIPO_PRESTACION&quot; &quot;BARRIO&quot;          &quot;total&quot;           &quot;COMUNA&quot;         
## [7] &quot;AÑO&quot;             &quot;MES&quot;</code></pre>
<p>Un momento. Las variables que identifican el lugar de un reclamo son las de barrio y comuna, pero la unidad de análisis de nuestro archivo espacial es el radio censal. ¿Cómo podemos cruzar los datos? Por suerte para nosotros, el dataset con los radios censales incluye columnas con barrio y comuna, así que las podemos usar para el cruce. Si no dispusiéramos de esa información, hubiéramos tenido que tomar el camino largo. Este consiste en conseguir un archivo espacial que contenga los límites de los barrios (o comunas) y hacer una operación llamada <em>spatial join</em> para cruzar los datos en base a sus coordenadas geográficas. La “unión espacial” permite poner condiciones como “unir los datos X con los datos Y en caso de que X esté <em>adentro</em> de Y”. Nosotros no vamos a necesitar recurrir a un <em>spatial join</em>, pero es bueno saber que la opción existe (la función es <code>st_join()</code>) en caso de que la necesitemos en el futuro.</p>
<p>Para poder cruzar las tablas de atención ciudadana y la de datos espaciales, necesitamos que la unidad de observación (la entidad que representa cada fila) sea la misma. Cómo el dataset de atención es el menos detallado a nivel espacial, corresponde hacer un agregado de los radios censales para calcular sus datos a nivel barrio o comuna. Vamos con los barrios, usando a nuestros viejos amigos <code>group_by</code> y <code>summary</code>.</p>
<p>Recordemos los nombres de columna de <code>radios</code>:</p>
<div class="sourceCode" id="cb264"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb264-1"><a href="6-5-volcando-en-el-mapa-información-de-múltiples-fuentes.html#cb264-1"></a><span class="kw">names</span>(radios)</span></code></pre></div>
<pre><code>## [1] &quot;RADIO_ID&quot;    &quot;BARRIO&quot;      &quot;COMUNA&quot;      &quot;POBLACION&quot;   &quot;VIVIENDAS&quot;   &quot;HOGARES&quot;     &quot;HOGARES_NBI&quot;
## [8] &quot;AREA_KM2&quot;    &quot;geometry&quot;</code></pre>
<p>Todas las unidades numéricas representan valores absolutos (no proporciones) así que es fácil pasarlas a un agregado por barrio; basta con sumarlas.</p>
<div class="sourceCode" id="cb266"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb266-1"><a href="6-5-volcando-en-el-mapa-información-de-múltiples-fuentes.html#cb266-1"></a>barrios_geo &lt;-<span class="st"> </span>radios <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb266-2"><a href="6-5-volcando-en-el-mapa-información-de-múltiples-fuentes.html#cb266-2"></a><span class="st">    </span><span class="kw">group_by</span>(BARRIO) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb266-3"><a href="6-5-volcando-en-el-mapa-información-de-múltiples-fuentes.html#cb266-3"></a><span class="st">    </span><span class="kw">summarise</span>(<span class="dt">POBLACION =</span> <span class="kw">sum</span>(POBLACION),</span>
<span id="cb266-4"><a href="6-5-volcando-en-el-mapa-información-de-múltiples-fuentes.html#cb266-4"></a>              <span class="dt">VIVIENDAS =</span> <span class="kw">sum</span>(VIVIENDAS),</span>
<span id="cb266-5"><a href="6-5-volcando-en-el-mapa-información-de-múltiples-fuentes.html#cb266-5"></a>              <span class="dt">HOGARES =</span> <span class="kw">sum</span>(HOGARES),</span>
<span id="cb266-6"><a href="6-5-volcando-en-el-mapa-información-de-múltiples-fuentes.html#cb266-6"></a>              <span class="dt">HOGARES_NBI =</span> <span class="kw">sum</span>(HOGARES_NBI),</span>
<span id="cb266-7"><a href="6-5-volcando-en-el-mapa-información-de-múltiples-fuentes.html#cb266-7"></a>              <span class="dt">AREA_KM2 =</span> <span class="kw">sum</span>(AREA_KM2))</span></code></pre></div>
<p>Y esto es lo lindo de trabajar con datos geográficos en forma de tabla: la columna <code>geometry</code>, la que guarda la información espacial, se crea en forma automática al hacer el <code>summarise</code>, y contiene la fronteras de la unidad de agregación - los barrios.</p>
<div class="sourceCode" id="cb267"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb267-1"><a href="6-5-volcando-en-el-mapa-información-de-múltiples-fuentes.html#cb267-1"></a><span class="kw">ggplot</span>() <span class="op">+</span><span class="st"> </span><span class="kw">geom_sf</span>(<span class="dt">data =</span> barrios_geo)</span></code></pre></div>
<p><img src="ciencia_de_datos_para_gente_sociable_files/figure-html/unnamed-chunk-160-1.png" width="672" /></p>
<p>Como efecto secundario de la operación (que en la jerga del <em>GIS</em> se conoce como “disolver polígonos”) podemos ver algunas líneas internas que han quedado como residuo de la unión de los radios censales. Es un problema muy común al trabajar con datos geográficos, dependiendo de la calidad de la fuente. Por suerte, en este caso el pequeño desperfecto no afecta nuestros planes. En pos de la prolijidad, podríamos realizar un ajuste fino y eliminar esas líneas internas, ya que hay varias técnicas para ello. Pero la complejidad de la tarea haría demasiado larga la explicación, así que vamos a dejarlo así… un recordatorio de que al trabajar con datos “reales” pasan estas cosas.</p>
<p>Ahora hagamos también un agregado por barrio de los datos de atención al ciudadano,</p>
<div class="sourceCode" id="cb268"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb268-1"><a href="6-5-volcando-en-el-mapa-información-de-múltiples-fuentes.html#cb268-1"></a>atencion_por_barrio &lt;-<span class="st"> </span>atencion_ciudadano <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb268-2"><a href="6-5-volcando-en-el-mapa-información-de-múltiples-fuentes.html#cb268-2"></a><span class="st">    </span><span class="kw">group_by</span>(BARRIO) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb268-3"><a href="6-5-volcando-en-el-mapa-información-de-múltiples-fuentes.html#cb268-3"></a><span class="st">    </span><span class="kw">summarise</span>(<span class="dt">total =</span> <span class="kw">sum</span>(total))</span>
<span id="cb268-4"><a href="6-5-volcando-en-el-mapa-información-de-múltiples-fuentes.html#cb268-4"></a></span>
<span id="cb268-5"><a href="6-5-volcando-en-el-mapa-información-de-múltiples-fuentes.html#cb268-5"></a><span class="kw">head</span>(atencion_por_barrio)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 2
##   BARRIO      total
##   &lt;chr&gt;       &lt;int&gt;
## 1 &quot; &quot;          5722
## 2 &quot;AGRONOMIA&quot;  9604
## 3 &quot;ALMAGRO&quot;   54190
## 4 &quot;BALVANERA&quot; 49540
## 5 &quot;BARRACAS&quot;  31752
## 6 &quot;BELGRANO&quot;  56522</code></pre>
<p>Ya tenemos las piezas necesarias: dos datasets con una columna en común que los relaciona (“BARRIO”) permitiendo cruzar los datos. Queremos conservar todas las observaciones del dataset geográfico, agregando los datos contenidos en el dataset de atención en donde la variable BARRIO sea la misma.</p>
<div class="sourceCode" id="cb270"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb270-1"><a href="6-5-volcando-en-el-mapa-información-de-múltiples-fuentes.html#cb270-1"></a>barrios_geo &lt;-<span class="st"> </span>barrios_geo <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">left_join</span>(atencion_por_barrio)</span></code></pre></div>
<pre><code>## Joining, by = &quot;BARRIO&quot;</code></pre>
<p>¡Ahora podemos hacer un mapa de cantidad de contactos por barrio!</p>
<div class="sourceCode" id="cb272"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb272-1"><a href="6-5-volcando-en-el-mapa-información-de-múltiples-fuentes.html#cb272-1"></a><span class="kw">ggplot</span>() <span class="op">+</span><span class="st"> </span><span class="kw">geom_sf</span>(<span class="dt">data =</span> barrios_geo, <span class="kw">aes</span>(<span class="dt">fill =</span> total))</span></code></pre></div>
<p><img src="ciencia_de_datos_para_gente_sociable_files/figure-html/unnamed-chunk-163-1.png" width="672" /></p>
<p>Tal como habíamos verificado cuando hicimos la exploración del dataset en el capítulo 2, en los barrios céntricos se registra la mayoría de los contactos. Podemos mejorar un poco el mapa, normalizando los datos para mostrar valores per cápita.</p>
<div class="sourceCode" id="cb273"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb273-1"><a href="6-5-volcando-en-el-mapa-información-de-múltiples-fuentes.html#cb273-1"></a><span class="kw">ggplot</span>() <span class="op">+</span><span class="st"> </span></span>
<span id="cb273-2"><a href="6-5-volcando-en-el-mapa-información-de-múltiples-fuentes.html#cb273-2"></a><span class="st">    </span><span class="kw">geom_sf</span>(<span class="dt">data =</span> barrios_geo, <span class="kw">aes</span>(<span class="dt">fill =</span> total<span class="op">/</span>POBLACION)) <span class="op">+</span></span>
<span id="cb273-3"><a href="6-5-volcando-en-el-mapa-información-de-múltiples-fuentes.html#cb273-3"></a><span class="st">    </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Contactos a atención ciudadana per cápita&quot;</span>,</span>
<span id="cb273-4"><a href="6-5-volcando-en-el-mapa-información-de-múltiples-fuentes.html#cb273-4"></a>         <span class="dt">subtitle =</span> <span class="st">&quot;Barrios de Ciudad Autónoma de Buenos Aires&quot;</span>,</span>
<span id="cb273-5"><a href="6-5-volcando-en-el-mapa-información-de-múltiples-fuentes.html#cb273-5"></a>         <span class="dt">fill =</span> <span class="st">&quot;contactos/habitante&quot;</span>)</span></code></pre></div>
<p><img src="ciencia_de_datos_para_gente_sociable_files/figure-html/unnamed-chunk-164-1.png" width="672" /></p>
<p>Normalizar los datos hace evidente que los barrios son parejos en su grado de demanda por habitante, exceptuando los casos salientes que mencionamos antes.</p>
<p>Hasta ahora hemos mostrado sobre un mapa variables numéricas, pero es igual de fácil representar variables categóricas. Imaginemos que quisiéramos mostrar el principal rubro por el cual se comunican los ciudadanos en cada barrio.</p>
<p>Usando los verbos de transformación que conocemos, la receta sería:</p>
<ol style="list-style-type: decimal">
<li>Agrupar los datos por barrio y por rubro</li>
<li>Crear un resumen con el total de contactos por rubro en cada barrio</li>
<li>Por cada grupo, filtrar los datos para conservar sólo el rubro que tiene la cantidad más grande de contactos</li>
</ol>
<div class="sourceCode" id="cb274"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb274-1"><a href="6-5-volcando-en-el-mapa-información-de-múltiples-fuentes.html#cb274-1"></a>atencion_por_barrio_principal_rubro &lt;-<span class="st"> </span>atencion_ciudadano <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb274-2"><a href="6-5-volcando-en-el-mapa-información-de-múltiples-fuentes.html#cb274-2"></a><span class="st">    </span><span class="kw">group_by</span>(BARRIO, RUBRO) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb274-3"><a href="6-5-volcando-en-el-mapa-información-de-múltiples-fuentes.html#cb274-3"></a><span class="st">    </span><span class="kw">summarise</span>(<span class="dt">contactos =</span> <span class="kw">sum</span>(total)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb274-4"><a href="6-5-volcando-en-el-mapa-información-de-múltiples-fuentes.html#cb274-4"></a><span class="st">    </span><span class="kw">filter</span>(contactos <span class="op">==</span><span class="st"> </span><span class="kw">max</span>(contactos))</span></code></pre></div>
<pre><code>## `summarise()` has grouped output by &#39;BARRIO&#39;. You can override using the `.groups` argument.</code></pre>
<div class="sourceCode" id="cb276"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb276-1"><a href="6-5-volcando-en-el-mapa-información-de-múltiples-fuentes.html#cb276-1"></a><span class="kw">head</span>(atencion_por_barrio_principal_rubro)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 3
## # Groups:   BARRIO [6]
##   BARRIO      RUBRO              contactos
##   &lt;chr&gt;       &lt;chr&gt;                  &lt;int&gt;
## 1 &quot; &quot;         REGISTRO CIVIL          5004
## 2 &quot;AGRONOMIA&quot; SANEAMIENTO URBANO      4691
## 3 &quot;ALMAGRO&quot;   SANEAMIENTO URBANO     22429
## 4 &quot;BALVANERA&quot; SANEAMIENTO URBANO     16840
## 5 &quot;BARRACAS&quot;  SANEAMIENTO URBANO     10138
## 6 &quot;BELGRANO&quot;  SANEAMIENTO URBANO     21060</code></pre>
<p>Como funciona esta cadena de verbos?</p>
<ol style="list-style-type: decimal">
<li><p><code>group_by()</code> agrupa los datos por barrio, y para cada barrio agrupa los datos por rubro.</p></li>
<li><p><code>summarise()</code> “pela” una capa de agrupamiento, la más externa que es rubro, y deja para cada barrio una sola fila por rubro, con la suma de sus totales.</p></li>
<li><p>El paso final en la cadena de transformación, <code>filter(contactos == max(contactos))</code> funciona porque todos los verbos de transformación respetan el agrupamiento. Es decir, si los datos fueron agrupados en forma previa, la función <code>filter()</code> aísla la fila con la cantidad máxima de contactos en cada uno de los grupos. En este caso, el agrupamiento que le llega a <code>filter()</code> es sólo por “BARRIOS”, porque la función <code>summarise()</code> borró la capa “RUBRO”. Resultado final: por cada barrio, una única fila que contiene el rubro que sumó más contactos</p></li>
</ol>
<p>Agregamos la información al dataset geográfico vía <code>left_join()</code></p>
<div class="sourceCode" id="cb278"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb278-1"><a href="6-5-volcando-en-el-mapa-información-de-múltiples-fuentes.html#cb278-1"></a>barrios_geo &lt;-<span class="st"> </span>barrios_geo <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">left_join</span>(atencion_por_barrio_principal_rubro)</span></code></pre></div>
<pre><code>## Joining, by = &quot;BARRIO&quot;</code></pre>
<p>Y mostramos el rubro principal por barrio en un mapa</p>
<div class="sourceCode" id="cb280"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb280-1"><a href="6-5-volcando-en-el-mapa-información-de-múltiples-fuentes.html#cb280-1"></a><span class="kw">ggplot</span>() <span class="op">+</span><span class="st"> </span></span>
<span id="cb280-2"><a href="6-5-volcando-en-el-mapa-información-de-múltiples-fuentes.html#cb280-2"></a><span class="st">    </span><span class="kw">geom_sf</span>(<span class="dt">data =</span> barrios_geo, <span class="kw">aes</span>(<span class="dt">fill =</span> RUBRO)) <span class="op">+</span></span>
<span id="cb280-3"><a href="6-5-volcando-en-el-mapa-información-de-múltiples-fuentes.html#cb280-3"></a><span class="st">    </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Principal categoría de las solicitudes/reclamos&quot;</span>)</span></code></pre></div>
<p><img src="ciencia_de_datos_para_gente_sociable_files/figure-html/unnamed-chunk-167-1.png" width="672" /></p>
</div>
<p style="text-align: center;">
<a href="6-4-visualizando-información-geográfica.html"><button class="btn btn-default">Previous</button></a>
<a href="6-6-combinando-capas-geográficas.html"><button class="btn btn-default">Next</button></a>
</p>
</div>
</div>


</div>

<script>

// add bootstrap table styles to pandoc tables
$(document).ready(function () {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
});

</script>

</body>
</html>
